# xlsgo

**xlsgo** 是一个易用、可配置、可扩展、高自由度的xls表格数据归集工具。通过配置文件，指定它筛选目录下所有的表格，对其特定列进行加工后，重新组织并生成新的列表。

它最初的制作目的是用于从不同银行流水明细表中抓取数据，但是也可以胜任其他任务场景。把它放出来，如果能发挥点小贡献，算做对开源社区的一点回馈。

## 特性
**递归** 搜索目录，自动发现 xls 表格。

**零解压** zip 档案直接访问，压缩包内含目录层次无缝递归搜索。

**可扩展** 按需加载 plugins 目录内模块完成定制任务。

**高自由度** 配置方式，可进行数据加工和多列数据配置。

**格式丰富** 兼容 xls、xlsx、csv，满足日常工作最大多数场景。

## 工作机制

 **xlsgo** 通过三个步骤完成任务：

  1. 第一步：从指定的列加载数据、使用常量生成合适数量的数据、从指定位置复制相应数量的数据。
     1. 允许插件同时加载不相邻的多列；
     2. 允许插件生成多列数据；
     1. 允许向插件传入参数，支持正则捕获；
  1. 第二步：对采集的数据进行加工，可跨列引用第一步的数据采集成果。
     5. 再次引用清洗后的数据进行二次加工；
     6. 可重复引用新数据；
  1. 第三步：对所有生成的数据进行裁切组装。 

## 配置文件

配置文件是由三部分组成的 `toml` 格式文件，包含：定义输出结果的根元素区、定义后处理的合并策略区、以及定义数据源和采集方法的数据区。

数据源被组织为一个字典，如 `["账户\\w{8}一般"]` 项下即是特定数据源表的采集方法。字典的键名用于匹配文件，字典的值对象则包含了数据列的引用名称、采集方法名、采集参数。最重要的参数是对于合并策略的选择，决定了采集的数据步执行什么后处理步骤。

合并策略被组织为一个列表，如每个 `[["合并策略"]]` 项下都是一个单独的策略。每个合并策略还包括一个后处理任务列表，完成数据交叉引用的相关加工任务。策略中同样可针对源数据指定二次加工方法。

## 默认功能插件

**column.OneShot**：从固定单元格取数，匹配其他列数据加载。

**column.ColumnHead**：指定列头，加载特定的（多个）数据列。

**column.ColumnUnited**：按照格式模式或组合模式参数，将多列数据整合为一列。

**column.ColumnUnited**：按照格式模式或组合模式参数，将多列数据整合为一列。

**column.IdentifyByColumn**：在多列中，根据数据出现的位置，生成一个标识。

**column.IdentifyByValue**：将某列数据的值，映射为一个标识。

**column.DateTimeFormator**：将多列日期时间格式进行整合，统一为格式化表示。

**column.NonSpaceEitherOne**：从多列数据中选择非空数据，合并为一列数据（典型场景两列借贷金额转换为单列收支金额）。

**column.PermutePeersAsCreditDebit**：根据标识列的分配多列（典型场景是根据收支关系调换收支双方的位置）

**column.TimestampNonceFromDate**：使用格式化的时间列生成时间戳和随机数。







## 静态打包

通过 pyinstaller 制作独立程序，在无 python 环境下使用。此种情况下插件内包须静态导入生成的程序中，可以在无 Python 环境的系统中使用

新增插件可通过 `--hidden-import` 传入 pyinstaller。

```commandline
pyinstaller.exe .\xlsgo.py --hidden-import column --hidden-import composing --hidden-import masquerade --hidden-import strtools -p .\src\ -p .\plugins\
```